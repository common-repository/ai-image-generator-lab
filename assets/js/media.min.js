/*!  This file in this program is included in minified and unminified versions, both located in the same directory.  Access unminified version by replacing the .min.js extension with .js  */window.jQuery(document).ready(function(e){var u,h,t=null,n=null;window.wpzai_update_ui=function(e){if(window.wpzai_update_quota(e),window.wpzAiImagesConfig&&window.wpzAiImagesConfig.settings){e.find(".wpz-ai-prompt-modifier .wpz-ai-images-active").removeClass("wpz-ai-images-active");for(t in window.wpzAiImagesConfig.settings)if(t.substring(0,9)==="modifier_"){var t,a,c,r=t.substring(9),o=e.find('.wpz-ai-prompt-modifier[data-category="'+r+'"]:first'),i=o.find('[data-modifier="'+window.wpzAiImagesConfig.settings[t]+'"]:first');i.length?(i.siblings().removeClass("wpz-ai-images-active").find("select").val(""),i.addClass("wpz-ai-images-active")):(a=o.find("select:first"),a.length&&(a.val(window.wpzAiImagesConfig.settings[t]),c=a.closest("li"),c.siblings().removeClass("wpz-ai-images-active"),c.addClass("wpz-ai-images-active").attr("data-modifier",window.wpzAiImagesConfig.settings[t]))),s(o,r,window.wpzAiImagesConfig.settings[t]),o.siblings('.wpz-ai-prompt-modifier[data-show-condition="'+r+'"][data-show-value="'+window.wpzAiImagesConfig.settings[t]+'"]').removeClass("wpz-ai-images-hidden")}else e.find(':input[name="'+t+'"]:first').val(window.wpzAiImagesConfig.settings[t]).change(),n&&(clearTimeout(n),n=null)}},window.wpzai_update_quota=function(t){var n=t.find(".wpz-ai-images-quota-notice span:first");n.length&&e.post(t.attr("data-api-url"),{action:"quota",key:t.attr("data-api-key")},function(e){typeof e=="object"&&(n.text(e.quotaRemaining),parseInt(e.quotaRemaining)?t.find(".wpz-ai-images-quota-empty-notice").addClass("wpz-ai-images-hidden"):(t.find(".wpz-ai-images-quota-empty-notice").removeClass("wpz-ai-images-hidden"),t.find(".wpz-ai-generate-button").attr("disabled",!0)))},"json")};function o(t){n&&clearTimeout(n),n=setTimeout(function(){n=null;var s={high_quality:parseInt(t.find('select[name="high_quality"]:first').val()),ratio:parseFloat(t.find('select[name="ratio"]:first').val()),width:parseInt(t.find('input[name="width"]:first').val()),height:parseInt(t.find('input[name="height"]:first').val()),edit_hd:t.find('input[name="edit_hd"]:first').is(":checked")?1:0};t.find(".wpz-ai-prompt-modifier .wpz-ai-images-active").each(function(){s["modifier_"+e(this).closest("[data-category]").attr("data-category")]=e(this).attr("data-modifier")}),e.post(window.wpzAiImagesConfig.ajaxurl,{action:"wpz-ai-images-settings-save",nonce:t.closest("[data-settings-save-nonce]").attr("data-settings-save-nonce"),settings:JSON.stringify(s)},function(){window.wpzAiImagesConfig.settings=s})},3e3)}function m(t){var n=[];return t.find(".wpz-ai-images-prompt-text table tbody td:first-child p").each(function(){var s={type:"text",text:e(this).text()},t=parseInt(e(this).closest("td").next().find("input").val());t&&t>1&&(s.weight=t),n.push(s)}),t.find(".wpz-ai-prompt-modifier .wpz-ai-images-active").each(function(){var t={type:"modifier",category:e(this).closest(".wpz-ai-prompt-modifier").attr("data-category"),modifier:e(this).attr("data-modifier")};n.push(t)}),n}e(document.body).on("click",".wpz-ai-images-toggle h3 a",function(){return e(this).parent().parent().toggleClass("wpz-ai-images-active").siblings().removeClass("wpz-ai-images-active"),!1});function a(e){var t=e.find(".wpz-ai-images-quota-empty-notice");return!t.length||t.hasClass("wpz-ai-images-hidden")}function l(t,n){for(var s,r=n.split(","),o=t.find("table tbody tr:last-child"),i=0;i<r.length;++i)s=o.clone(),s.children(":first").empty().append(e("<a>").attr({href:"#",title:"Remove"}).append(e("<span>").text("Remove")).addClass("wpz-ai-images-remove")).append(e("<p>").text(r[i].trim())),s.find("input:first").val(1).trigger("change"),s.insertBefore(o);o.closest(".wpz-ai-prompt-generator").find(".wpz-ai-generate-button:first").attr("disabled",!a(t))}e(document.body).on("click",".wpz-ai-images-sample-prompts a",function(){return l(e(this).closest(".wpz-ai-images-prompt-text"),e(this).text()),!1}),e(document.body).on("click",".wpz-ai-images-prompt-text .wpz-ai-images-add",function(){var n=e(this).closest(".wpz-ai-images-prompt-text"),t=n.find("tbody tr:last-child");l(n,t.find("textarea").val()),t.find("textarea:first").val("").trigger("input"),t.find("input:first").val(1).trigger("change")}),e(document.body).on("input",".wpz-ai-images-prompt-text textarea",function(){e(this).closest("table").find(".wpz-ai-images-add").attr("disabled",e(this).val()==="")}),e(document.body).on("keyup",".wpz-ai-images-prompt-text textarea",function(t){t.originalEvent.keyCode==13&&(t.preventDefault(),e(this).closest("table").find(".wpz-ai-images-add").trigger("click"))}),e(document.body).on("change",".wpz-ai-images-prompt-text input",function(){var t=e(this),n=t.val();t.siblings(".wpz-ai-images-decrease").attr("disabled",n<2),t.siblings(".wpz-ai-images-increase").attr("disabled",n>4)}),e(document.body).on("click",".wpz-ai-images-prompt-text .wpz-ai-images-decrease",function(){var n=e(this).siblings("input"),t=n.val();t>=2&&(--t,n.val(t).trigger("change"))}),e(document.body).on("click",".wpz-ai-images-prompt-text .wpz-ai-images-increase",function(){var n=e(this).siblings("input"),t=n.val();t<=4&&(++t,n.val(t).trigger("change"),t>4&&e(this).attr("disabled",!0),e(this).siblings(".wpz-ai-images-decrease").attr("disabled",null))});function s(t,n,o){var i=t.siblings('.wpz-ai-prompt-modifier[data-show-condition="'+n+'"]'+(o?':not([data-show-value="'+o+'"])':"")).addClass("wpz-ai-images-hidden");i.find(".wpz-ai-images-active").removeClass("wpz-ai-images-active"),i.each(function(){s(t,e(this).attr("data-category"))})}e(document.body).on("click",".wpz-ai-prompt-modifier a",function(){var a,t=e(this).closest("li"),n=t.closest(".wpz-ai-prompt-modifier"),r=n.closest(".wpz-ai-images-form"),i=n.attr("data-category");return t.hasClass("wpz-ai-images-active")?(t.removeClass("wpz-ai-images-active"),s(n,i)):(a=t.attr("data-modifier"),t.siblings().removeClass("wpz-ai-images-active").find("select").val(""),t.addClass("wpz-ai-images-active"),s(n,i,a),n.siblings('.wpz-ai-prompt-modifier[data-show-condition="'+i+'"][data-show-value="'+a+'"]').removeClass("wpz-ai-images-hidden")),o(r),!1}),e(document.body).on("change",".wpz-ai-prompt-modifier .wpz-ai-images-other select",function(){var n=e(this).val(),i=e(this).closest("li"),t=i.closest(".wpz-ai-prompt-modifier"),a=t.attr("data-category");n?(i.siblings().removeClass("wpz-ai-images-active"),i.addClass("wpz-ai-images-active").attr("data-modifier",n),s(t,a,n),t.siblings('.wpz-ai-prompt-modifier[data-show-condition="'+a+'"][data-show-value="'+n+'"]').removeClass("wpz-ai-images-hidden")):(i.removeClass("wpz-ai-images-active"),s(t,a)),o(t.closest(".wpz-ai-images-form"))}),e(document.body).on("change",'.wpz-ai-images-form select[name="high_quality"], .wpz-ai-images-form input[name="edit_hd"]',function(){o(e(this).closest(".wpz-ai-images-form"))}),e(document.body).on("click",".wpz-ai-prompt-output .wpz-ai-images-weight-add",function(){var t=e(this).closest("li"),n=parseInt(t.attr("data-weight"));t.attr("data-weight",n?n+1:2)}),e(document.body).on("click",".wpz-ai-prompt-output .wpz-ai-images-weight-subtract",function(){var t=e(this).closest("li"),n=parseInt(t.attr("data-weight"));t.attr("data-weight",n==2?null:n-1)}),e(document.body).on("click",".wpz-ai-images-prompt-text .wpz-ai-images-remove",function(){var t=e(this).closest("tr");return t.siblings().length<2&&t.closest(".wpz-ai-prompt-generator").find(".wpz-ai-generate-button:first").attr("disabled",!0),t.remove(),!1});function r(e){return 1-e%1<1e-4?Math.ceil(e):Math.floor(e)}function d(e){return e.closest(".wpz-ai-images-upload-ui").hasClass("wpz-ai-images-pro")?2048:768}e(document.body).on("click",".wpz-ai-images-show",function(){e(this).siblings(".wpz-ai-images-upload-ui:first").removeClass("wpz-ai-images-hidden"),e(this).remove()}),e(document.body).on("change",'.wpz-ai-images-form select[name="ratio"]',function(){var i,c,u,h,f,m=e(this),t=parseFloat(m.val()),s=m.closest(".wpz-ai-images-form"),l=d(s),a=s.find('input[name="width"]:first'),n=s.find('input[name="height"]:first');a.parent().toggleClass("wpz-ai-images-hidden",t!==0),t?(f=n.val()>768||n.val()*t>768,u=Math.min(l,r(l*t)),c=Math.min(l,r(l/t)),i=Math.round(n.val()*t),i>u?(h=r(u/t),n.val(h),i=Math.round(h*t)):n.val()>c&&(n.val(c),i=Math.round(c*t)),a.val(i)):(f=a.val()>768||n.val()>768),s.find(".wpz-ai-images-hd-notice:first").toggleClass("wpz-ai-images-hidden",a.val()<=768&&n.val()<=768),o(s)}),e(document.body).on("change",'.wpz-ai-images-form input[name="width"], .wpz-ai-images-form input[name="height"]',function(){if(e(this).attr("name")==="height")var n,i,a,r,c,l=!0,t=e(this),s=t.closest(".wpz-ai-images-form").find('input[name="width"]:first');else l=!1,s=e(this),t=s.closest(".wpz-ai-images-form").find('input[name="height"]:first');n=d(t),i=parseFloat(t.closest(".wpz-ai-images-form").find('select[name="ratio"]:first').val()),i?(r=t.val()>768||t.val()*i>768,a=Math.round(Math.min(n,n/i)),t.val()>a&&t.val(a),s.val(Math.round(parseFloat(t.val())*i))):(r=s.val()>768||t.val()>768,s.val()>n&&s.val(n),t.val()>n&&t.val(n)),c=t.closest(".wpz-ai-images-form"),c.find(".wpz-ai-images-hd-notice:first").toggleClass("wpz-ai-images-hidden",!r),o(c)}),e(document.body).on("click",".wpz-ai-clear-text-button",function(){e(this).closest("table").find("tbody tr:not(:last-child)").remove(),e(this).closest(".wpz-ai-prompt-generator").find(".wpz-ai-generate-button:first").attr("disabled",!0)}),e(document.body).on("click",".wpz-ai-images-preview .wpz-ai-images-arrow-previous, .wpz-ai-images-preview .wpz-ai-images-arrow-next",function(){var n=e(this).closest(".wpz-ai-images-preview"),s=e(this).hasClass("wpz-ai-images-arrow-previous"),t=parseInt(n.attr("data-index"));if(s&&!t)return;return s?--t:++t,n.css("background-image","url("+n.attr("data-url-"+(t+1))+")").attr("data-index",t),n.toggleClass("wpz-ai-images-preview-last",!n.is("[data-url-"+(t+2)+"]")),!1}),e(document.body).on("keyup",function(t){var n=e(".wpz-ai-images-preview:visible");if(n.length&&[27,39,37].indexOf(t.originalEvent.keyCode)!==-1)switch(t.preventDefault(),t.originalEvent.keyCode){case 27:n.parent().remove();break;case 39:n.is("[data-url-"+(parseInt(n.attr("data-index"))+2)+"]")&&n.find(".wpz-ai-images-arrow-next:first").trigger("click");break;case 37:parseInt(n.attr("data-index"))!==0&&n.find(".wpz-ai-images-arrow-previous:first").trigger("click");break}});function i(t){t.addClass("wpz-ai-images-uploading"),e.post(window.wpzAiImagesConfig.ajaxurl,{action:"wpz-ai-images-upload",url:t.attr("data-url-get"),postId:window.wp&&window.wp.media&&window.wp.media.model?window.wp.media.model.settings.post.id:0,prompt:t.closest(".wpz-ai-images-results").attr("data-prompt"),nonce:t.closest(".wpz-ai-images-upload-ui").attr("data-get-nonce")},function(n){if(n.success&&n.data)if(n.data.wait)setTimeout(function(){i(t)},3e3);else if(window.wp&&window.wp.media&&window.wp.media.model){var o,s=n.data;s.uploading=!1,o=new window.wp.media.model.Attachment(s),window.wp.Uploader.queue.add(o),window.wp.Uploader.queue.reset(),e(".media-modal #menu-item-browse").trigger("click"),t.removeClass("wpz-ai-images-uploading")}else window.pagenow==="media"&&(location.href="upload.php");else t.removeClass("wpz-ai-images-uploading")},"json").fail(function(){t.removeClass("wpz-ai-images-uploading")}).always(function(){window.wpzai_update_quota(t.closest(".wpz-ai-images-upload-ui"))})}e(document.body).on("click",".wpz-ai-images-results a, .wpz-ai-images-result-button-view",function(){var n,o,t=e(this).closest("li"),s=t.parent().children();if(!t.attr("data-url-preview")||t.hasClass("wpz-ai-images-loading"))return;o={"data-index":t.index()};for(n=0;n<s.length;++n)o["data-url-"+(n+1)]=s.eq(n).attr("data-url-preview");return e("<div>").addClass("wpz-ai-images-preview-container").toggleClass("wpz-ai-images-free",t.closest(".wpz-ai-images-free").length).append(e("<div>").addClass("wpz-ai-images-preview").attr(o).css({"background-image":"url("+t.attr("data-url-preview")+")","max-width":t.parent().attr("data-preview-width")+"px"}).append(e("<div>").addClass("wpz-ai-images-buttons").append(e("<button>").attr("type","button").addClass("button-primary").text("Get this image").on("click",function(){var t=e(this).closest(".wpz-ai-images-preview").attr("data-index");e(this).closest(".wpz-ai-images-preview-container").remove(),i(s.eq(t))})).append(e("<button>").attr("type","button").addClass("button-secondary").text("Edit Image").on("click",function(){var n=t.closest(".wpz-ai-images-upload-ui"),o=e(this).closest(".wpz-ai-images-preview").attr("data-index");n.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image:first").removeClass("wpz-ai-images-hidden").addClass("wpz-ai-images-active").siblings(".wpz-ai-images-toggle").addClass("wpz-ai-images-hidden"),n.find(".wpz-ai-images-edit-hd").hide(),c(e("<img>").attr("src",s.eq(o).attr("data-url-preview")).appendTo(n.find(".wpz-ai-image-editor:first").empty())),n.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image textarea:first").val(n.find(".wpz-ai-images-results:first").attr("data-prompt")),n.find(".wpz-ai-generate-button:first").attr("disabled",!0),n.find(".wpz-ai-back-button:first").removeClass("wpz-ai-images-hidden"),e(this).closest(".wpz-ai-images-preview-container").remove()})).append(e("<button>").attr("type","button").addClass("button-secondary").text("Close").on("click",function(){e(this).closest(".wpz-ai-images-preview-container").remove()})).append(e("<a>").addClass("wpz-ai-images-arrow-previous").attr({href:"#",title:"Go to previous image"})).append(e("<a>").addClass("wpz-ai-images-arrow-next").attr({href:"#",title:"Go to next image"}))).append(e("<div>").addClass("wpz-ai-tooltip-box").append(e("<span>").addClass("wpz-ai-tooltip-box-text-watermark").text("Downloaded files will not contain visible watermarks.")))).appendTo(document.body),!1});function c(t){var n=null;t.on("mousedown",function(s){if(s.button===0){var o,i=t.offset();n={elem:e("<div>").addClass("wpz-ai-images-mask-area").insertAfter(t),x:s.offsetX,y:s.offsetY},o=e("<div>").addClass("wpz-ai-images-mask-drag-area").insertAfter(t),o.on("mousemove",function(e){if(n){var t=e.offsetX-n.x,s=e.offsetY-n.y;n.elem.css({width:Math.abs(t)+"px",height:Math.abs(s)+"px",left:(t<0?n.x+t:n.x)+"px",top:(s<0?n.y+s:n.y)+"px"})}}),o.on("mouseup mouseout",function(){n=null,o.closest(".wpz-ai-images-form").find(".wpz-ai-generate-button:first").attr("disabled",!a(o)),o.remove()})}})}e(document.body).on("click",".wpz-ai-images-mask-area",function(){var t=e(this);t.siblings(".wpz-ai-images-mask-area").length||t.closest(".wpz-ai-images-form").find(".wpz-ai-generate-button:first").attr("disabled",!0),t.remove()}),e(document.body).on("click",".wpz-ai-back-button",function(){var t=e(this).closest(".wpz-ai-images-form");t.find(".wpz-ai-images-toggle").removeClass("wpz-ai-images-hidden"),t.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image").addClass("wpz-ai-images-hidden"),t.find(".wpz-ai-generate-button:first").attr("disabled",t.find(".wpz-ai-images-prompt-text tbody tr").length<2||!a(t)),e(this).addClass("wpz-ai-images-hidden")}),e(document.body).on("click",".wpz-ai-images-notice-close-button",function(){e(this).closest(".wpz-ai-images-notice").fadeOut()}),e(document.body).on("click",".wpz-ai-images-form .wpz-ai-generate-button",function(){var s,o,a,r,l,d,p,n=e(this).closest(".wpz-ai-images-upload-ui"),f=setTimeout(function(){n.find(".wpz-ai-images-results-container .wpz-ai-images-notice:first").fadeIn()},3e4),u=n.find(".wpz-ai-images-feedback");u.hide(),r=m(n),console.log(r),d="";for(l=0;l<r.length;++l)r[l].type==="text"&&(d+=(d?" ":"")+r[l].text);t&&(clearTimeout(t),t=null);function h(s){e.post(n.attr("data-api-url"),s,function(s){if(s.urls){var a,h,m,g,o=n.find(".wpz-ai-images-results"),l=o.closest(".media-modal .media-frame-content, html").first(),p=0,r=o.parent();for(l.scrollTop(0);!r.is(l)&&!r.has(l).length;)p+=r.position().top,r=r.offsetParent();l.scrollTop(p-20),o.removeClass("wpz-ai-images-placeholders").attr({"data-prompt":d,"data-preview-width":s.previewSize&&s.previewSize.length?s.previewSize[0]:768}),g=o.children().addClass("wpz-ai-images-hidden");for(a=0;a<s.urls.length;++a)h=g.eq(a).removeClass("wpz-ai-images-hidden"),h.attr("data-url-preview",s.urls[a].preview).attr("data-url-get",s.urls[a].get).addClass("wpz-ai-images-loading"),m=h.find("img:first"),m.attr({src:m.attr("data-placeholder-src"),alt:"Generated image placeholder"});function v(){o.children(".wpz-ai-images-loading:first").each(function(){var s=e(this);e.get(s.attr("data-url-preview"),null,function(){f&&(clearTimeout(f),f=null),n.find(".wpz-ai-images-results-container .wpz-ai-images-notice:first").fadeOut(),s.removeClass("wpz-ai-images-loading"),s.find("img:first").attr({src:s.attr("data-url-preview"),alt:"Image result preview for "+d}).closest("li").each(function(){e(this).children(".wpz-ai-images-result-buttons:first").length||e("<div>").addClass("wpz-ai-images-result-buttons").append(e("<button>").addClass("wpz-ai-images-result-button-save").attr({type:"button",title:"Get this image"}).on("click",function(){i(e(this).closest("li"))})).append(e("<button>").addClass("wpz-ai-images-result-button-edit").attr({type:"button",title:"Edit image"}).on("click",function(){var n=e(this).closest("li"),t=n.closest(".wpz-ai-images-upload-ui");t.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image:first").removeClass("wpz-ai-images-hidden").addClass("wpz-ai-images-active").siblings(".wpz-ai-images-toggle").addClass("wpz-ai-images-hidden"),c(e("<img>").attr("src",n.attr("data-url-preview")).appendTo(t.find(".wpz-ai-image-editor:first").empty())),t.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image textarea:first").val(t.find(".wpz-ai-images-results:first").attr("data-prompt")),t.find(".wpz-ai-generate-button:first").attr("disabled",!0),t.find(".wpz-ai-back-button:first").removeClass("wpz-ai-images-hidden")})).append(e("<button>").addClass("wpz-ai-images-result-button-view").attr({type:"button",title:"View image"})).appendTo(this)})}).always(function(){o.has(".wpz-ai-images-loading").length?t=setTimeout(v,1e3):(clearTimeout(t),t=null,u.children().show().filter(".wpz-ai-images-feedback-complete:first").hide(),u.show())})})}t=setTimeout(v,1e3)}},"json").fail(function(e){switch(e.status){case 451:alert("Your prompt text contains word(s) or phrase(s) which may violate our terms of use. Please try rewriting your prompt to remove any content that is not permitted on this service.");break;case 429:alert("You have reached the maximum number of requests that you may make at this time. Please try again later.");break;default:alert("Something went wrong when submitting your request. Please try again, and if the problem persists please wait a bit before submitting your request again.")}})}return n.has(".wpz-ai-images-toggle.wpz-ai-images-edit-image:not(.wpz-ai-images-hidden)").length?(o=n.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image:first"),p=o.find(".wpz-ai-images-mask-area").get().map(function(t){var n=e(t);return[n.position().left/n.parent().width(),n.position().top/n.parent().height(),n.width()/n.parent().width(),n.height()/n.parent().height()]}),console.log(p),s={action:"generate",key:n.attr("data-api-key"),p:JSON.stringify([{type:"text",text:o.find("textarea:first").val()}]),q:n.find('select[name="high_quality"]:first').val(),m:JSON.stringify(p)},o.find(".wpz-ai-image-editor img:first").hasClass("wpz-ai-image-custom")?(o.find('input[name="edit_hd"]:checked:first').length&&(s.eHd=1),a=new XMLHttpRequest,a.open("GET",o.find(".wpz-ai-image-editor img:first").attr("src")),a.responseType="blob",a.onload=function(){var e=new FileReader;e.onload=function(){s.e=e.result,h(s)},e.readAsDataURL(a.response)},a.send()):(s.e=o.find(".wpz-ai-image-editor img:first").attr("src"),h(s))):(s={action:"generate",key:n.attr("data-api-key"),p:JSON.stringify(r),q:n.find('select[name="high_quality"]:first').val(),w:n.find('input[name="width"]:first').val(),h:n.find('input[name="height"]:first').val()},h(s)),!1}),e(document.body).on("mouseover focus",".wpz-ai-images-feedback-stars button",function(){for(var t=e(this).parent();t.length;)t.addClass("wpz-ai-images-active"),t=t.prev();for(t=e(this).parent().next();t.length;)t.removeClass("wpz-ai-images-active"),t=t.next()}),e(document.body).on("mouseout blur",".wpz-ai-images-feedback-stars button",function(){var t=e(this).parent().parent(),n=parseInt(t.attr("data-value"));n?(t.children(":lt("+n+")").addClass("wpz-ai-images-active"),t.children(":gt("+(n-1)+")").removeClass("wpz-ai-images-active")):t.children().removeClass("wpz-ai-images-active")}),e(document.body).on("click",".wpz-ai-images-feedback-stars button",function(){var t=e(this).parent().parent().attr("data-value",e(this).parent().index()+1)}),e(document.body).on("click",".wpz-ai-images-feedback-submit",function(){e(this).addClass("wpz-ai-iamges-loading").attr("disabled",!0);var n,t=e(this).closest(".wpz-ai-images-feedback"),i=parseInt(t.find(".wpz-ai-images-feedback-stars:first").attr("data-value")),a=t.find("textarea:first").val(),s=t.closest(".wpz-ai-images-upload-ui").find(".wpz-ai-images-results:first li:first").attr("data-url-preview").split("/"),o={request:s[s.length-3]+"-"+s[s.length-2]};i&&(o.rating=i/5),a&&(o.feedback=a),n=t.closest(".wpz-ai-images-upload-ui").attr("data-api-url"),n=n.substring(0,n.lastIndexOf("/"))+"/feedback.php",e.post(n,o).always(function(){t.children(":not(h4)").hide(),t.children(".wpz-ai-images-feedback-complete:first").show()})}),window.wp&&window.wp.media&&window.wp.media.view&&window.wp.media.view.MediaFrame&&window.wp.media.view.MediaFrame.Select&&window.wp.media.view.MediaFrame.Select.prototype.bindHandlers&&window.wp.media.view.MediaFrame.Select.prototype.browseRouter&&(u=window.wp.media.view.MediaFrame.Select.prototype.bindHandlers,window.wp.media.view.MediaFrame.Select.prototype.bindHandlers=function(){return this.on("content:render:wpzai",this.uploadContent,this),u.apply(this,arguments)},h=window.wp.media.view.MediaFrame.Select.prototype.browseRouter,window.wp.media.view.MediaFrame.Select.prototype.browseRouter=function(e){var t=h.apply(this,arguments);return e._views.upload&&e.set({wpzai:{text:"Generate Image with AI",priority:60}}),t}),e("#tmpl-attachment-details-two-column").each(function(){var t=e(this).html(),n=t.indexOf("</button>",t.indexOf('class="attachment-actions"'))+9,t=t.substring(0,n)+'<button type="button" class="button wpz-ai-images-edit-image-button">Edit in AI Image Lab</button>'+t.substring(n);e(this).html(t)}),e(document.body).on("click",".wpz-ai-images-edit-image-button",function(){var n,s,o,i=e(this).closest(".media-frame-content").find(".attachment-details-copy-link:first").val(),t=e(".wpz-ai-images-upload-ui:first");for(t.is(":visible")||e(".wpz-ai-images-page-title-action").click(),t.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image:first").removeClass("wpz-ai-images-hidden").addClass("wpz-ai-images-active").siblings(".wpz-ai-images-toggle").addClass("wpz-ai-images-hidden"),t.find(".wpz-ai-images-edit-hd").show(),c(e("<img>").attr("src",i).appendTo(t.find(".wpz-ai-image-editor:first").empty()).addClass("wpz-ai-image-custom")),t.find(".wpz-ai-images-toggle.wpz-ai-images-edit-image textarea:first").val(""),t.find(".wpz-ai-generate-button:first").attr("disabled",!0),t.find(".wpz-ai-back-button:first").removeClass("wpz-ai-images-hidden"),wp.media.frame.close(),s=t.closest(".media-modal .media-frame-content, html").first(),o=0,n=t.find(".wpz-ai-images-form"),s.scrollTop(0);!n.is(s)&&!n.has(s).length;)o+=n.position().top,n=n.offsetParent();s.scrollTop(o-20)})})